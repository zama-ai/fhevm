name: gateway-stress-tool-docker-build

on:
  workflow_dispatch:

permissions: {}

concurrency:
  group: fhevm-gateway-stress-tool-${{ github.ref_name }}
  cancel-in-progress: ${{ github.ref != 'refs/heads/main' }}

jobs:
  build:
    name: gateway-stress-tool-docker-build/build
    uses: zama-ai/ci-templates/.github/workflows/common-docker.yml@e666182756172bc747d2be6e4eb9b4ed80a00a0e
    secrets:
      AWS_ACCESS_KEY_S3_USER: ${{ secrets.AWS_ACCESS_KEY_S3_USER }}
      AWS_SECRET_KEY_S3_USER: ${{ secrets.AWS_SECRET_KEY_S3_USER }}
      BLOCKCHAIN_ACTIONS_TOKEN: ${{ secrets.BLOCKCHAIN_ACTIONS_TOKEN }}
      CGR_USERNAME: ${{ secrets.CGR_USERNAME }}
      CGR_PASSWORD: ${{ secrets.CGR_PASSWORD }}
    permissions:
      # Required to read workflow run information
      actions: 'read'
      # Required to checkout repository code
      contents: 'read'
      # Required to read pull request information
      pull-requests: 'read'
      # Required to create build attestations
      attestations: write
      # Required to publish Docker images
      packages: 'write'
      # Required for OIDC authentication
      id-token: 'write'
    with:
      use-cgr-secrets: true
      working-directory: "."
      docker-context: "."
      push_image: true
      image-name: "fhevm/test-suite/gateway-stress-tool"
      docker-file: "./test-suite/gateway-stress/Dockerfile"
      app-cache-dir: "fhevm-gateway-stress-tool"
