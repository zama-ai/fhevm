# =============================================================================
# FHEVM Smart Contracts Configuration
# =============================================================================
# This chart handles the deployment and management of FHEVM smart contracts
# for both Gateway and Host chains, including:
# - Contract deployment
# - Contract upgrades
# - Configuration management
# - Debugging utilities
# =============================================================================

# NOTE: These values are for reference only
# The chart is shared between gateway and host deployments

# -----------------------------------------------------------------------------
# Smart Contract Deployment
# -----------------------------------------------------------------------------
# Handles initial deployment of all required smart contracts
scDeploy:
  enabled: true

  # Prevent redeployment if already done for current version
  # preventRedeployment: false

  nameOverride:

  image:
    name: ghcr.io/zama-ai/fhevm/host-contracts
    tag: v0.9.0

  # ConfigMap to store deployed contract addresses
  configmap:
    create: true
    name: "sc-addresses"
    annotations:

  # Environment variables for contract deployment
  env:
    # =========================================================================
    # ==========================  GATEWAY =====================================
    # =========================================================================

    # KMS generation threshold
    - name: KMS_GENERATION_THRESHOLD
      value: 7

    # S3 URL for KMS core storage (replace x with sequential number starting from 0)
    - name: KMS_NODE_STORAGE_URL_x
      value: ""

    # Deployer's private key
    - name: DEPLOYER_PRIVATE_KEY
      value: ""

    # Pauser set contract address
    - name: PAUSER_SET_ADDRESS
      value: ""

    # Number of pausers
    # Should be set to the number of registered operators, ie `n_kms + n_copro` with `n_kms` the
    # number of KMS nodes and `n_copro` the number of coprocessors
    - name: NUM_PAUSERS
      value: 18

    # Pauser addresses (replace x with sequential number starting from 0 up to NUM_PAUSERS - 1)
    # Each operator has its own hot wallet address used as pauser
    - name: PAUSER_ADDRESS_x
      value: ""

    # =========================================================================
    # ==========================  HOST    =====================================
    # =========================================================================

      # Deployer's private key
    - name: DEPLOYER_PRIVATE_KEY
      value: ""

    # Pauser set contract address
    - name: PAUSER_SET_CONTRACT_ADDRESS
      value: ""

    # Number of pausers
    # Should be set to the number of registered operators, ie `n_kms + n_copro` with `n_kms` the
    # number of KMS nodes and `n_copro` the number of coprocessors
    - name: NUM_PAUSERS
      value: 18

    # Pauser addresses (replace x with sequential number starting from 0 up to NUM_PAUSERS - 1)
    # Each operator has its own hot wallet address used as pauser
    - name: PAUSER_ADDRESS_x
      value: ""

  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

  # Security context for container execution
  securityContext:
    runAsNonRoot: true
    runAsUser: 10000
    fsGroup: 10001

  # Deployment commands executed in sequence
  deployCommands:
    # =========================================================================
    # ==========================  GATEWAY =====================================
    # =========================================================================
    # Deploy all gateway contracts
    - npx hardhat task:deployAllGatewayContracts

    # Register host chains in the gateway
    - npx hardhat task:addHostChainsToGatewayConfig

    # Add pausers to the gateway contracts
    - npx hardhat task:addGatewayPausers

    # =========================================================================
    # ==========================  HOST    =====================================
    # =========================================================================
    # Deploy all host contracts
    - npx hardhat task:deployAllHostContracts

    # Add pausers to the host contracts
    - npx hardhat task:addHostPausers

  # Contract verification on block explorers
  verifyContracts: false

# -----------------------------------------------------------------------------
# Smart Contract Upgrade
# -----------------------------------------------------------------------------
# Handles upgrades of existing smart contracts
scUpgrade:
  enabled: false

  # Configuration for old contracts (used during upgrade process)
  oldContracts:
    image:
      name: ghcr.io/zama-ai/fhevm/host-contracts
      tag: v0.8.1

  # Note: The upgrade process uses the new contracts image from scDeploy.image

  # Upgrade commands executed during contract upgrade
  upgradeCommands:
    # Example upgrade command (uncomment and modify as needed)
    # - npx hardhat task:upgradeACL

# -----------------------------------------------------------------------------
# Node Placement Configuration
# -----------------------------------------------------------------------------
# Uncomment to use specific node selector and toleration for deployment

# nodeSelector:
#   kubernetes.io/arch: amd64

# tolerations:
#   - key: "node.kubernetes.io/arch"
#     operator: "Equal"
#     value: "amd64"
#     effect: "NoSchedule"

# affinity:
#   nodeAffinity:
#     required:
#       nodeSelectorTerm:
#         matchExpressions:
#           - key: kubernetes.io/arch
#             operator: In
#             values:
#               - amd64

# -----------------------------------------------------------------------------
# Smart Contract Debugging
# -----------------------------------------------------------------------------
# Utilities for debugging smart contract deployments
scDebug:
  enabled: false
  nameOverride:

# -----------------------------------------------------------------------------
# Persistent Storage Configuration
# -----------------------------------------------------------------------------
# Configuration for persistent volumes used during deployment
persistence:
  enabled: true
  mountPath: /app/addresses
  volumeClaim:
    name: ""
    create: true
    storageClassName: ""
    storageCapacity: 1Gi

# -----------------------------------------------------------------------------
# Global Pod Configuration
# -----------------------------------------------------------------------------
# Pod annotations for additional metadata
# See: https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/
podAnnotations: {}

# Pod labels for selection and organization
# See: https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/
podLabels: {}
