# =============================================================================
# FHEVM Coprocessor Configuration
# =============================================================================
# This chart deploys the FHEVM coprocessor components including:
# - Configuration setup
# - Database migration
# - Host listener (blockchain event processing)
# - Gateway listener (gateway event processing)
# - TFHE worker (FHE computation)
# - ZK proof worker (zero-knowledge proof generation)
# - SNS worker (notification service)
# - Transaction sender (blockchain transaction submission)
# =============================================================================

# -----------------------------------------------------------------------------
# Configuration Setup
# -----------------------------------------------------------------------------
# Initializes secrets and configuration required by other components
config:
  enabled: true

  image:
    name: ghcr.io/zama-ai/kube-utils
    tag: 0.1.0

  # Coprocessor cryptographic key configuration
  # TODO: this should be deprecated, to be confirmed
  coprocessorKey:
    secret:
      name: coprocessor-key
      key: coprocessor.hex

  # Database connection configuration
  database:
    secret:
      name: coprocessor-db-url
      key: coprocessor-db-url
      value: "postgresql://postgres:postgres@postgresql:5432/coprocessor"

  # Helm hook annotations for deployment ordering
  annotations:
    # "helm.sh/hook": "pre-install"
    # "helm.sh/hook-weight": "-1"

  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

# -----------------------------------------------------------------------------
# Database Migration
# -----------------------------------------------------------------------------
# Sets up the database schema and initial data
dbMigration:
  enabled: true

  # Helm hook annotations for deployment ordering
  annotations:
    # "helm.sh/hook": "pre-install, pre-upgrade"
    # "helm.sh/hook-weight": "0"
    # "helm.sh/hook-needs": "config-setup"

  image:
    name: ghcr.io/zama-ai/fhevm-db-migration
    tag: v0.9.0

  # Environment variables for migration process
  env:
    - name: CHAIN_ID
      value: "12345"
    - name: DATABASE_URL
      valueFrom:
        secretKeyRef:
          name: coprocessor-db-url
          key: coprocessor-db-url

  serviceAccountName:

  # Persistent volume for migration data
  storage:
    size: 2Gi

  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

  affinity:
    enabled: false

  tolerations:
    enabled: false
    items: []

# -----------------------------------------------------------------------------
# Host Listener
# -----------------------------------------------------------------------------
# Processes blockchain events from the host chain
hostListener:
  enabled: false
  nameOverride:

  image:
    name: ghcr.io/zama-ai/fhevm-coprocessor
    tag: v0.9.0

  replicas: 1

  # Environment variables
  env:
    - name: DATABASE_URL
      valueFrom:
        secretKeyRef:
          name: coprocessor-db-url
          key: coprocessor-db-url

  # Command line arguments for the host listener
  args:
    - --database-url=$(DATABASE_URL)
    - --url=$(ETHEREUM_RPC_URL)
    - --acl-contract-address=$(ACL_CONTRACT_ADDRESS)
    - --tfhe-contract-address=$(FHEVM_EXECUTOR_CONTRACT_ADDRESS)
    - --initial-block-time=12  # it can switch to real blockTime when data is available
    - --log-level=INFO
    - --health-port=8080
    - --reorg-maximum-duration-in-blocks=50

    ### Dependence chains parameters
    # - --dependence-cache-size=10000
    # - --dependence-by-connexity   # Whether to build connected components or linear chains (default no)
    # - --dependence-cross-block    # Do chains cross L1 block boundaries (default yes)
    # - --dependent-ops-max-per-chain=0   # Max dependent ops per chain before slow-lane (0 disables)

    ### Catchup parameters (optional)
    # - --catchup-margin
    # - --catchup-paging
    # - --start-at-block  # To be used to catch up from a specific block
    # - --end-at-block    # To be used to stop at a specific block

    ### New in v0.10
    - --service-name="host-listener"
    - --catchup-finalization-in-blocks=20  # Continuous catchup will wait for block "finalization"

    ### New in v0.11
    # - --timeout-request-websocket=15 # OPTIONAL, Default timeout in seconds for websocket interactions

  # Service ports configuration
  ports:
    metrics: 9100
    healthcheck: 8080

  serviceMonitor:
    enabled: false

  serviceAccountName:

  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

  # Health check probes
  probes:
    liveness:
      enabled: false
      httpGet:
        path: /liveness
        port: healthcheck
      initialDelaySeconds: 10
      periodSeconds: 10
    readiness:
      enabled: false
      httpGet:
        path: /healthz
        port: healthcheck
      initialDelaySeconds: 5
      periodSeconds: 10

  affinity:
    enabled: false

  tolerations:
    enabled: false
    items: []

  updateStrategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 0

# -----------------------------------------------------------------------------
# Host Listener Poller
# -----------------------------------------------------------------------------
# Processes blockchain events from the host chain
hostListenerPoller:
  enabled: false
  nameOverride:

  image:
    name: ghcr.io/zama-ai/fhevm-coprocessor
    tag: v0.10.0

  replicas: 1

  # Environment variables
  env:
    - name: DATABASE_URL
      valueFrom:
        secretKeyRef:
          name: coprocessor-db-url
          key: coprocessor-db-url

  # Command line arguments for the host listener poller
  args:
    ### Required parameters
    - --database-url=$(DATABASE_URL)
    - --url=$(ETHEREUM_RPC_HTTP_URL)
    - --acl-contract-address=$(ACL_CONTRACT_ADDRESS)
    - --tfhe-contract-address=$(FHEVM_EXECUTOR_CONTRACT_ADDRESS)

    ### Polling and block processing parameters
    - --finality-lag=3
    - --batch-size=100  # Maximum number of blocks to process per iteration
    - --poll-interval-ms=6000  # Sleep duration between iterations in milliseconds (half block time ~6s for Ethereum)
    - --retry-interval-ms=1000  # Backoff between retry attempts for RPC/DB failures in milliseconds
    - --max-http-retries=45  # Maximum number of HTTP/RPC retry attempts before failing an operation
    - --rpc-compute-units-per-second=1000  # Rate limiting budget for RPC calls during block catchup (compute units per second)

    ### Observability parameters
    - --log-level=INFO
    - --health-port=8080
    - --service-name=host-listener-poller

    ### Prometheus metrics
    - --metrics-addr=0.0.0.0:9100  # Address for Prometheus metrics HTTP server

    ### Dependence chains parameters
    # - --dependence-cache-size=10000
    # - --dependence-by-connexity   # Whether to build connected components or linear chains (default no)
    # - --dependence-cross-block    # Do chains cross L1 block boundaries (default yes)
    # - --dependent-ops-max-per-chain=0   # Max dependent ops per chain before slow-lane (0 disables)

  # Service ports configuration
  ports:
    metrics: 9100
    healthcheck: 8080

  serviceMonitor:
    enabled: false

  serviceAccountName:

  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

  # Health check probes
  probes:
    liveness:
      enabled: false
      httpGet:
        path: /liveness
        port: healthcheck
      initialDelaySeconds: 10
      periodSeconds: 10
    readiness:
      enabled: false
      httpGet:
        path: /healthz
        port: healthcheck
      initialDelaySeconds: 5
      periodSeconds: 10

  affinity:
    enabled: false

  tolerations:
    enabled: false
    items: []

  updateStrategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 0

# -----------------------------------------------------------------------------
# Host Listener Catchup Only
# -----------------------------------------------------------------------------
# Host listener variant that runs only the catchup loop without real-time subscription.
hostListenerCatchupOnly:
  enabled: false
  nameOverride:

  image:
    name: ghcr.io/zama-ai/fhevm-coprocessor
    tag: v0.10.0

  replicas: 1

  # Environment variables
  env:
    - name: DATABASE_URL
      valueFrom:
        secretKeyRef:
          name: coprocessor-db-url
          key: coprocessor-db-url

  # Command line arguments for the host listener catchup only mode
  # NOTE: --only-catchup-loop requires --end-at-block to be set
  args:
    - --database-url=$(DATABASE_URL)
    - --url=$(ETHEREUM_RPC_URL)
    - --acl-contract-address=$(ACL_CONTRACT_ADDRESS)
    - --tfhe-contract-address=$(FHEVM_EXECUTOR_CONTRACT_ADDRESS)
    - --initial-block-time=12
    - --log-level=INFO
    - --health-port=8080
    - --dependence-cache-size=128
    - --reorg-maximum-duration-in-blocks=50
    - --service-name="host-listener-catchup-only"
    - --catchup-finalization-in-blocks=20

    ### Catchup-only specific parameters (required)
    - --only-catchup-loop
    - --end-at-block=-15  # Relative to latest block (negative value)
    - --catchup-loop-sleep-secs=60

    ### Optional catchup parameters
    # - --start-at-block  # To catch up from a specific block
    # - --catchup-margin
    # - --catchup-paging
    # - --dependent-ops-max-per-chain=0   # Max dependent ops per chain before slow-lane (0 disables)

  # Service ports configuration
  ports:
    metrics: 9100
    healthcheck: 8080

  serviceMonitor:
    enabled: false

  serviceAccountName:

  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

  # Health check probes
  probes:
    liveness:
      enabled: false
      httpGet:
        path: /liveness
        port: healthcheck
      initialDelaySeconds: 10
      periodSeconds: 10
    readiness:
      enabled: false
      httpGet:
        path: /healthz
        port: healthcheck
      initialDelaySeconds: 5
      periodSeconds: 10

  affinity:
    enabled: false

  tolerations:
    enabled: false
    items: []

  updateStrategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 0

# -----------------------------------------------------------------------------
# Gateway Listener
# -----------------------------------------------------------------------------
# Processes events from the gateway chain
gwListener:
  enabled: false
  nameOverride:

  image:
    name: ghcr.io/zama-ai/fhevm-coprocessor
    tag: v0.9.0

  replicas: 1

  env:
    # =========================================================================
    # NEW ENVIRONMENT VARIABLES
    # =========================================================================
    # The address of the KMSGeneration contract
    - name: KMS_GENERATION_ADDRESS
      value: ""

  # Command line arguments for the gateway listener
  args:
    - --database-url=$(DATABASE_URL)
    - --database-pool-size=16
    - --verify-proof-req-database-channel=event_zkpok_new_work
    - --gw-url=ws://gateway-rpc-node:8548
    - --input-verification-address=$(INPUT_VERIFICATION_ADDRESS)
    - --kms-generation-address=$(KMS_GENERATION_ADDRESS)
    - --error-sleep-initial-secs=1
    - --error-sleep-max-secs=10
    - --health-check-port=8080
    - --metrics-addr=0.0.0.0:9100
    - --provider-max-retries=4294967295
    - --provider-retry-interval=4s
    - --log-level=INFO
    - --get-logs-poll-interval=500ms
    - --get-logs-block-batch-size=100
    - --service-name=gw-listener
    - --log-last-processed-every-number-of-updates=50
    ### Replay parameters (optional)
    # --replay-from-block BLOCK_NUMBER
    # To go back in time from latest block
    # --replay-from-block -NB_BLOCK

  # Service ports configuration
  ports:
    metrics: 9100
    healthcheck: 8080

  serviceMonitor:
    enabled: false

  serviceAccountName:

  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

  # Health check probes
  probes:
    liveness:
      enabled: false
      httpGet:
        path: /liveness
        port: healthcheck
      initialDelaySeconds: 10
      periodSeconds: 10
    readiness:
      enabled: false
      httpGet:
        path: /healthz
        port: healthcheck
      initialDelaySeconds: 5
      periodSeconds: 10

  affinity:
    enabled: false

  tolerations:
    enabled: false
    items: []

  updateStrategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 0

# -----------------------------------------------------------------------------
# TFHE Worker
# -----------------------------------------------------------------------------
# Performs FHE (Fully Homomorphic Encryption) computations
tfheWorker:
  enabled: true
  nameOverride:

  image:
    name: ghcr.io/zama-ai/fhevm-coprocessor
    tag: v0.9.0

  replicas: 1

  # Environment variables
  env:
    - name: DATABASE_URL
      valueFrom:
        secretKeyRef:
          name: coprocessor-db-url
          key: coprocessor-db-url
    - name: ACL_CONTRACT_ADDRESS
      value: "0x05fD9B5EFE0a996095f42Ed7e77c390810CF660c"

  # Command line arguments for TFHE worker
  args:
    - --database-url=$(DATABASE_URL)
    - --run-bg-worker=true
    - --worker-polling-interval-ms=10000
    - --work-items-batch-size=100  # scheduling changed
    - --dependence-chains-per-batch=100  # Deprecated. To be removed in a future release.
    - --key-cache-size=32
    - --coprocessor-fhe-threads=64  # scheduling changed
    - --tokio-threads=16  # scheduling changed
    - --pg-pool-max-connections=10
    - --metrics-addr=0.0.0.0:9100
    - --service-name=tfhe-worker  # tfhe-worker service name in OTLP traces
    - --log-level=INFO
    # Should not be used (unsafe - testing only, keep 0/false values except CI)
    - --run-server=false
    - --generate-fhe-keys=false
    - --server-maximum-ciphertexts-to-schedule=0
    - --server-maximum-ciphertexts-to-get=0
    - --maximum-compact-inputs-upload=0
    - --maximum-handles-per-input=0
    - --server-addr=""
    - --coprocessor-private-key=""
    # Unique worker identifier (valid UUID v4 format)
    # If not set, defaults to a random UUID generated at startup
    - --worker-id=$(WORKER_ID)
    - --dcid-ttl-sec=30  # Time-to-live (in seconds) for dependence chain locks
    # Disable dependence chain ID locking
    # WARNING: May cause multiple workers to process the same DCID concurrently
    # Defaults to false
    - --disable-dcid-locking=false
    # Time slice (in seconds) for processing a single dependence chain
    # Locks are released if processing exceeds this duration
    - --dcid-timeslice-sec=90
    # Processed DCIDs older than this value are cleaned up
    # Defaults to 48 hours (172800 seconds)
    # Time-to-live (in seconds) for processed dependence chains
    - --processed-dcid-ttl-sec=172800
    - --dcid-cleanup-interval-sec=3600  # Interval (in seconds) for cleaning up expired DCID locks
    - --dcid-max-no-progress-cycles=2   # Worker cycles without progress before releasing

  # Service ports configuration
  ports:
    metrics: 9100
    healthcheck: 8080

  serviceMonitor:
    enabled: false

  serviceAccountName:

  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

  # Health check probes
  probes:
    liveness:
      enabled: false
      httpGet:
        path: /liveness
        port: healthcheck
      initialDelaySeconds: 10
      periodSeconds: 10
    readiness:
      enabled: false
      httpGet:
        path: /healthz
        port: healthcheck
      initialDelaySeconds: 5
      periodSeconds: 10

  # Distributed tracing configuration
  tracing:
    enabled: false
    endpoint: ""
    service: "coprocessor_server"

  affinity:
    enabled: false

  tolerations:
    enabled: false
    items: []

  updateStrategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 0

  # Horizontal Pod Autoscaler configuration
  hpa:
    enabled: false
    minReplicas: 1
    maxReplicas: 10
    targetCPUUtilizationPercentage: 80
    behavior:
      scaleUp:
        stabilizationWindowSeconds: 60
        selectPolicy: Max
        policies:
          - type: Percent
            value: 100
            periodSeconds: 15
          - type: Pods
            value: 2
            periodSeconds: 60
      scaleDown:
        stabilizationWindowSeconds: 300
        selectPolicy: Min
        policies:
          - type: Percent
            value: 40
            periodSeconds: 60

# -----------------------------------------------------------------------------
# ZK Proof Worker
# -----------------------------------------------------------------------------
# Generates zero-knowledge proofs for verification
zkProofWorker:
  enabled: false
  nameOverride:

  image:
    name: ghcr.io/zama-ai/fhevm-coprocessor
    tag: v0.9.0

  replicas: 1

  # Environment variables
  env:
    - name: DATABASE_URL
      valueFrom:
        secretKeyRef:
          name: coprocessor-db-url
          key: coprocessor-db-url

  # Command line arguments for ZK proof worker
  args:
    - --database-url=$(DATABASE_URL)
    - --pg-listen-channel=event_zkpok_new_work
    - --pg-notify-channel=event_zkpok_computed
    - --pg-polling-interval=5
    - --pg-pool-connections=5
    - --pg-timeout=15s
    - --worker-thread-count=8
    - --service-name=zkproof-worker
    - --log-level=INFO
    # - --pg-auto-explain-with-min-duration="30s"

  # Service ports configuration
  ports:
    metrics: 9100
    healthcheck: 8080

  serviceMonitor:
    enabled: false

  serviceAccountName:

  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

  # Health check probes
  probes:
    liveness:
      enabled: false
      httpGet:
        path: /liveness
        port: healthcheck
      initialDelaySeconds: 10
      periodSeconds: 10
    readiness:
      enabled: false
      httpGet:
        path: /healthz
        port: healthcheck
      initialDelaySeconds: 5
      periodSeconds: 10

  affinity:
    enabled: false

  tolerations:
    enabled: false
    items: []

  updateStrategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 0

  # Horizontal Pod Autoscaler configuration
  hpa:
    enabled: false
    minReplicas: 1
    maxReplicas: 10
    targetCPUUtilizationPercentage: 80
    behavior:
      scaleUp:
        stabilizationWindowSeconds: 60
        selectPolicy: Max
        policies:
          - type: Percent
            value: 100
            periodSeconds: 15
          - type: Pods
            value: 2
            periodSeconds: 60
      scaleDown:
        stabilizationWindowSeconds: 300
        selectPolicy: Min
        policies:
          - type: Percent
            value: 40
            periodSeconds: 60

# -----------------------------------------------------------------------------
# SNS Worker
# -----------------------------------------------------------------------------
# Handles Simple Notification Service operations
snsWorker:
  enabled: false
  nameOverride:

  image:
    name: ghcr.io/zama-ai/fhevm-coprocessor
    tag: v0.9.0

  replicas: 1

  # Environment variables
  env:
    - name: DATABASE_URL
      valueFrom:
        secretKeyRef:
          name: coprocessor-db-url
          key: coprocessor-db-url

  # Command line arguments for SNS worker
  args:
    - --database-url=$(DATABASE_URL)
    - --pg-listen-channels
    - event_pbs_computations
    - event_ciphertext_computed
    - --pg-notify-channel
    - event_ciphertext128_computed
    - --work-items-batch-size=20
    - --pg-polling-interval=1
    - --pg-pool-connections=10
    - --pg-timeout=15s
    - --bucket-name-ct64=$(S3_BUCKET_NAME)
    - --bucket-name-ct128=$(S3_BUCKET_NAME)
    - --s3-max-concurrent-uploads=100
    - --s3-max-retries-per-upload=100
    - --s3-max-backoff=10s
    - --s3-max-retries-timeout=120s
    - --s3-recheck-duration=2s
    - --s3-regular-recheck-duration=120s
    - --gc-batch-size=80
    - --cleanup-interval=120s
    - --liveness-threshold=70s
    - --lifo=false
    - --enable-compression=true
    - --schedule-policy=rayon_parallel
    - --service-name=sns-worker
    - --log-level=INFO
    # Only enable `gauge-update-interval-secs` for some of the workers to reduce DB load and not have duplicate metrics data for no reason.
    # --gauge-update-interval-secs=10
    # - --pg-auto-explain-with-min-duration="30s"
    # - --keys-file-path

  # Service ports configuration
  ports:
    metrics: 9100
    healthcheck: 8080

  serviceMonitor:
    enabled: false

  serviceAccountName:

  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

  # Health check probes
  probes:
    liveness:
      enabled: false
      httpGet:
        path: /liveness
        port: healthcheck
      initialDelaySeconds: 10
      periodSeconds: 10
    readiness:
      enabled: false
      httpGet:
        path: /healthz
        port: healthcheck
      initialDelaySeconds: 5
      periodSeconds: 10

  affinity:
    enabled: false

  tolerations:
    enabled: false
    items: []

  updateStrategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 0

  # Horizontal Pod Autoscaler configuration
  hpa:
    enabled: false
    minReplicas: 1
    maxReplicas: 10
    targetCPUUtilizationPercentage: 80
    behavior:
      scaleUp:
        stabilizationWindowSeconds: 60
        selectPolicy: Max
        policies:
          - type: Percent
            value: 100
            periodSeconds: 15
          - type: Pods
            value: 2
            periodSeconds: 60
      scaleDown:
        stabilizationWindowSeconds: 300
        selectPolicy: Min
        policies:
          - type: Percent
            value: 40
            periodSeconds: 60

# -----------------------------------------------------------------------------
# Transaction Sender
# -----------------------------------------------------------------------------
# Submits transactions to the blockchain
txSender:
  enabled: false
  nameOverride:

  image:
    name: ghcr.io/zama-ai/fhevm-coprocessor
    tag: v0.9.0

  replicas: 1

  # Environment variables
  env:
    - name: DATABASE_URL
      valueFrom:
        secretKeyRef:
          name: coprocessor-db-url
          key: coprocessor-db-url
    - name: TX_SENDER_PRIVATE_KEY
      value: "0x8f82b3f482c19a95ac29c82cf048c076ed0de2530c64a73f2d2d7d1e64b5cc6e"
    - name: INPUT_VERIFICATION_ADDRESS
      valueFrom:
        configMapKeyRef:
          name: gateway-sc-addresses
          key: input_verification.address
    - name: CIPHERTEXT_COMMITS_ADDRESS
      valueFrom:
        configMapKeyRef:
          name: gateway-sc-addresses
          key: ciphertext_commits.address
    - name: MULTICHAIN_ACL_ADDRESS
      valueFrom:
        configMapKeyRef:
          name: gw-sc-addresses
          key: multichain_acl.address

  # Command line arguments for transaction sender
  args:
    - --input-verification-address=$(INPUT_VERIFICATION_ADDRESS)
    - --ciphertext-commits-address=$(CIPHERTEXT_COMMITS_ADDRESS)
    - --multichain-acl-address=$(MULTICHAIN_ACL_ADDRESS)
    - --gateway-url=ws://gateway-rpc-node:8548
    - --signer-type=private-key
    - --private-key=$(TX_SENDER_PRIVATE_KEY)
    - --database-url=$(DATABASE_URL)
    - --database-pool-size=10
    - --database-polling-interval-secs=1
    - --verify-proof-resp-database-channel=event_zkpok_computed
    - --add-ciphertexts-database-channel=event_ciphertexts_uploaded
    - --allow-handle-database-channel=event_allowed_handle
    - --verify-proof-resp-batch-limit=128
    - --verify-proof-resp-max-retries=6
    - --verify-proof-remove-after-max-retries
    - --add-ciphertexts-batch-limit=10
    - --allow-handle-batch-limit=10
    - --allow-handle-max-retries=2147483647
    - --add-ciphertexts-max-retries=2147483647
    - --error-sleep-initial-secs=1
    - --error-sleep-max-secs=4
    - --txn-receipt-timeout-secs=4
    - --review-after-unlimited-retries=30
    - --provider-max-retries=4294967295
    - --provider-retry-interval=4s
    - --health-check-port=8080
    - --metrics-addr=0.0.0.0:9100
    - --health-check-timeout=4s
    - --log-level=INFO
    - --gas-limit-overprovision-percent=120
    - --graceful-shutdown-timeout=8s
    - --service-name=txn-sender
    # New in 0.10
    - --metric-host-txn-latency=0.1:60.0:0.1
    - --metric-zkproof-txn-latency=0.1:60.0:0.1
    - --gauge-update-interval-secs=10
    - --host-chain-url=$(ETHEREUM_RPC_URL)
    - --delegation-block-delay=10  # not applied immediately to avoid reorg
    - --delegation-clear-after-n_blocks=648000  # ~3 months at 12s block time, only on successful delegations
    - --delegation-fallback-polling=30  # polling fallback in seconds when notification are not received
    - --delegation-max-retry=100000  # does not include immediate retry on transient error which are infinite
    - --retry-immediately-on-nonce-error=0  # Deprecated. To be removed in a future release.

  # Service ports configuration
  ports:
    metrics: 9100
    healthcheck: 8080

  serviceMonitor:
    enabled: false

  serviceAccountName:

  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

  # Health check probes
  probes:
    liveness:
      enabled: false
      httpGet:
        path: /liveness
        port: healthcheck
      initialDelaySeconds: 10
      periodSeconds: 10
    readiness:
      enabled: false
      httpGet:
        path: /healthz
        port: healthcheck
      initialDelaySeconds: 5
      periodSeconds: 10

  affinity:
    enabled: false

  tolerations:
    enabled: false
    items: []

  updateStrategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 0

# -----------------------------------------------------------------------------
# Global Pod Configuration
# -----------------------------------------------------------------------------
# Pod annotations for additional metadata
# See: https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/
podAnnotations: {}

# Pod labels for selection and organization
# See: https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/
podLabels: {}
