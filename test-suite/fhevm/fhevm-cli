#!/bin/bash
set -e

SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
LEGACY_CLI="${SCRIPT_DIR}/fhevm-cli.legacy"
BUN_CLI="${SCRIPT_DIR}/scripts/bun/cli.ts"
CLI_IMPL="${FHEVM_CLI_IMPL:-bun}"

if [[ "$CLI_IMPL" == "legacy" ]]; then
  exec "$LEGACY_CLI" "$@"
fi

if ! command -v bun >/dev/null 2>&1; then
  echo "[ERROR] bun runtime is required for fhevm-cli. Install bun or run with FHEVM_CLI_IMPL=legacy." >&2
  exit 1
fi

exec bun "$BUN_CLI" "$@"
