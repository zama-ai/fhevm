# KmsManagement contract

This section describes the `KmsManagement` contract. It is used to orchestrate KMS-related materials for the fhevm Gateway protocol.

ðŸš§ **Important** ðŸš§: The contract is currently neither used nor up-to-date. It will be reworked in the future. See [this issue](https://github.com/zama-ai/fhevm-gateway/issues/108) for more details.

The contract is used to:

- [Generate FHE keys](#generate-fhe-keys)
- [Generate KSKs](#generate-ksks)
- [Generate CRSs](#generate-crs)
- [Store parameters](#store-parameters)

All non-view functions are only callable by the owner of the contract.

## Public material generation

The `KmsManagement` contract is used to generate different public materials needed by the fhevm protocol.

### Generate FHE keys

A new public key is generated by the KMS with privately shared key shares for FHE keys. The private key shares are used by the KMS to decrypt ciphertexts. The public key is used by the coprocessors in order to be able to perform homomorphic operations on ciphertexts.

To trigger its generation, the owner needs to call the `keygenRequest` function available in the `KmsManagement` contract. A public FHE key is then identified by a unique `keyId`.

### Generate KSKs

A Key-Switching Key (KSK) is a special public key generated by the KMS that can switch a ciphertext encrypted under key A to a ciphertext encrypted under key B.

To trigger its generation, the owner needs to call the `kskgenRequest` function available in the `KmsManagement` contract. A KSK is then identified by a unique `kskId` and can only be used between 2 distinct `keyId`s.

### Generate CRSs

A powers-of-tau Common Reference String (CRS) is a correlated random material generated by the KMS in a secure manner that is required to construct certain ZKPoKs. In particular, it is used for proving knowledge of a plaintext encrypted under FHE keys.

To trigger its generation, the owner needs to call the `crsgenRequest` function available in the `KmsManagement` contract. A CRS is then identified by a unique `crsId`.

## Store parameters

The `KmsManagement` contract is used to store different parameters used by the above generation functions:

- FHE parameters
- KSK parameters
- CRS parameters

When a specific generation function is called, the associated parameters are loaded from storage and inserted in the emitted events. This allows the KMS to be aware of which parameters to consider for the generation of the corresponding material.

These parameters are set at the deployment of the `KmsManagement` contract and can be updated later on by the owner.
